name: hello-oracle-database

services:
  oracle-db:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: oracle-xe
    ports:
      - "1521:1521"
      - "5500:5500"
    environment:
      ORACLE_PWD: ${ORACLE_PWD}
      ORACLE_SID: ${ORACLE_SID:-XE}
      ORACLE_PDB: ${ORACLE_PDB:-XEPDB1}
      ORACLE_CHARACTERSET: ${ORACLE_CHARACTERSET:-AL32UTF8}
      TZ: Asia/Seoul
      NLS_LANG: KOREAN_KOREA.AL32UTF8
    volumes:
      - oracle-data:/opt/oracle/oradata
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "30"
    healthcheck:
      test: ["CMD-SHELL", "echo 'SELECT 1 FROM DUAL;' | sqlplus -s sys/${ORACLE_PWD}@localhost:1521/XE as sysdba || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20m

  uptime-kuma:
    image: louislam/uptime-kuma:2.1.0
    container_name: uptime-kuma
    ports:
      - "3001:3001"
    volumes:
      - uptime-kuma-data:/app/data
    restart: unless-stopped
    environment:
      - TZ=Asia/Seoul
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
    healthcheck:
      test: ["CMD-SHELL", "node extra/healthcheck.js"]
      interval: 60s
      timeout: 10s
      retries: 3

volumes:
  oracle-data:
  uptime-kuma-data: